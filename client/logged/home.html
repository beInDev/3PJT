<template name="home">
    {{#if currentUser }}
    <div id="homeWrapper">
        <div id="userContainer" class="homeContainer container">
            <table>
                <tr>
                    <td></td>
                    <td id="currentUsernameContainer">
                        {{#if currentUser.profile.fullname }} {{! Does the current user have a fullname ? If yes, then show it. }}
                            <span class="fullname separator">
                                {{ currentUser.profile.fullname }}
                            </span>
                        {{/if}}
                        <span class="username">{{currentUser.username}}</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="content" id="pictureContainer">
                            <img src="GabbleN.png" alt="profile picture" id="userPicture"/>
                        </div>
                    </td>
                    <td>
                        <form id="gabForm">
                            <label for="gabArea">
                                <textarea rows="5" cols="51" maxlength="255" id="gabArea"></textarea>
                            </label>
                            <input type="submit" id="gabSubmit" value=">"/>
                        </form>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <span class="charCount"> {{charCount}} / 255</span>
                    </td>
                </tr>
            </table>
        </div>
        {{#if gabs }}
            <ul class="gabsContainer">
                {{#each gabs}}
                    {{> gab}}
                {{/each}}
            </ul>
        {{/if}}
    </div>
    {{/if}}
    <!-- {{emails.[0].address}} to get users email thanks to #with -->
</template>

<template name="gab">
    <li class="gabContainer" id="{{ _id }}">
    {{#unless equals author currentUser._id}}
        <div class="{{#unless liked _id}}gabUnliked{{else}}gabLiked{{/unless}}"></div>
    {{/unless}}
        <div class="gabPicture">
            <img src="GabbleN.png" alt="gabbler picture"/>
        </div>
        <div class="gabContent">
            {{#unless equals author currentUser._id}} {{! Is the current user the author ? }}
                {{#with getUser author }}
                    {{#if profile.fullname }} {{! Does the author have a fullname ? If yes, then show it. }}
                <span class="fullname separator">
                    {{profile.fullname}}
                </span>
                    {{/if}}
                {{/with}}
            {{else}}
                {{#if currentUser.profile.fullname }} {{! Does the current user have a fullname ? If yes, then show it. }}
                <span class="fullname separator">
                     {{ currentUser.profile.fullname }}
                </span>
                {{/if}}
            {{/unless}}
            <span class="username separator">
            {{#unless equals author currentUser._id}}
                {{#with getUser author }} {{username}} {{/with}}
            {{else}}
                {{ currentUser.username }} (you)
            {{/unless}}
            </span>

            <time class="separator">{{ formatDate createdAt }}</time><time>{{ formatHour createdAt }}</time><br />

            <p>{{ content }} [{{likeCounter}}] </p>
        </div>
    </li>
</template>